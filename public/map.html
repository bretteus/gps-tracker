<html><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<head>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script src="/public/leaflet-realtime"></script>
</head>
<body style="margin:0">
<div id="map" style="height: 300px; margin:0; padding:0;"></div>
<script type="text/javascript">
    var map = L.map('map');

    var layer = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'bretteus.p8fjfj59',
        accessToken: 'pk.eyJ1IjoiYnJldHRldXMiLCJhIjoiY2lsMmdnOHFwM2NjN3ZvbTNoMTI4dGZ6ciJ9.tkYgKdNa7r7YRtO9SLgouw'
    }).addTo(map);

    var realtime = L.realtime({
        url: '/coordinates',
        crossOrigin: true,
        type: 'json'
    }, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup((new Date(feature.properties.timestamp).toString()));
        },
        internal: 5 * 1000 * 60 // 5 minutes
    }).addTo(map);

    realtime.on('update', function() {
        map.fitBounds(realtime.getBounds(), {maxZoom: 14});
    });

</script>
</body>
</html>